<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.simplecss.org/simple.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
  <link rel="icon" href="assets/favicon.png" type="image/png">
  <title>CTERA File Services Platform - AWS Marketplace Fulfillment</title>
</head>

<body>
      <header>
      <div class="header-content">
        <img src="assets/logo.png" alt="CTERA Logo">
        <div class="header-buttons">
        <a href="https://www.ctera.com/company/contact/" target="_blank">CONTACT US</a>
        <a href="https://www.ctera.com/support/" target="_blank">SUPPORT CENTER</a>
        <a href="https://kb.ctera.com/" target="_blank">KNOWLEDGE BASE</a>
      </div>
    </div>
  </header>
  
  <div class="maincontainer">
    <!-- Registration Complete Section (shown when step=registration-complete) -->
    <div id="registration-complete-section" style="display: none;">
      <div class="loading-container">
        <h2 class="loading-title">✅ AWS Marketplace Registration Complete</h2>
        <p class="loading-message">
          Your AWS Marketplace subscription has been successfully registered with CTERA.<br>
          If you have not received your portal credentials via email, please contact CTERA support.
        </p>
        
        <div class="success-message">
          <div class="success-title">What Should Happen Next</div>
          <div class="success-details">
            <ol>
              <li><strong>Check your email</strong> for CTERA portal access credentials</li>
              <li><strong>Check your spam folder</strong> if you don't see the email</li>
              <li><strong>Contact CTERA support</strong> if you haven't received credentials within 10 minutes</li>
            </ol>
          </div>
        </div>

        <div class="customer-info" id="reg-customer-info" style="display: none;">
          <div class="customer-info-title">Your Subscription Details</div>
          <div class="customer-detail">
            <span class="customer-label">Customer ID:</span>
            <span class="customer-value" id="reg-customer-id">Loading...</span>
          </div>
          <div class="customer-detail">
            <span class="customer-label">Product Code:</span>
            <span class="customer-value" id="reg-product-code">Loading...</span>
          </div>
          <div class="customer-detail">
            <span class="customer-label">Status:</span>
            <span class="customer-value" style="color: #00CDAF;">REGISTERED</span>
          </div>
        </div>

        <div class="next-steps">
          <div class="next-steps-title">Need Help? Contact CTERA Support</div>
          <div class="next-steps-content">
            <p><strong>If you haven't received your portal credentials or need assistance:</strong></p>
            <ul>
              <li>Email: <a href="mailto:support@ctera.com" style="color: #00B4E5;">support@ctera.com</a></li>
              <li>Include your Customer ID and Product Code (shown above) in your message</li>
              <li>Mention that you completed AWS Marketplace registration but need portal access</li>
            </ul>
            <p style="margin-top: 15px; font-size: 13px; color: rgba(255,255,255,0.7);">
              Our support team will verify your subscription and ensure you receive your portal credentials promptly.
            </p>
          </div>
        </div>

        <button id="reg-show-token-btn" type="button" style="margin-top: 30px; background: #00B4E5; color: #fff; border: none; padding: 8px 18px; border-radius: 4px; font-family: 'Montserrat', Arial, sans-serif; font-weight: 500; cursor: pointer; transition: background 0.3s;">
          Show Details for Support
        </button>
        <div id="reg-token-support-section" style="display: none; margin-top: 20px;">
          <span style="color: #00B4E5;">Additional Details for Support:</span>
          <pre id="reg-aws-token" style="color: #fff; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 6px; word-break: break-all; font-size: 0.95em;">Loading...</pre>
          <div style="font-size:0.8em; color:rgba(255,255,255,0.7); margin-top:8px;">Share these details with CTERA support if they request additional information about your subscription.</div>
        </div>
      </div>
    </div>

    <!-- Error Section (shown when error parameter is present) -->
    <div id="error-section" style="display: none;">
      <div class="loading-container">
        <h2 class="loading-title" style="color: #ff6b6b;">❌ Registration Error</h2>
        <p class="loading-message" id="error-message">
          There was an error processing your AWS Marketplace registration.
        </p>
        
        <div class="next-steps" style="border-color: rgba(255, 107, 107, 0.3); background-color: rgba(255, 107, 107, 0.1);">
          <div class="next-steps-title" style="color: #ff6b6b;">What to do next:</div>
          <div class="next-steps-content">
            <ol>
              <li><strong>Try subscribing again</strong> from AWS Marketplace</li>
              <li><strong>Check your subscription status</strong> in the AWS Marketplace console</li>
              <li><strong>Contact support</strong> if the problem persists</li>
            </ol>
            <p>You can also share the error details below with our support team for faster assistance.</p>
          </div>
        </div>

        <button id="error-show-details-btn" type="button" style="margin-top: 30px; background: #ff6b6b; color: #fff; border: none; padding: 8px 18px; border-radius: 4px; font-family: 'Montserrat', Arial, sans-serif; font-weight: 500; cursor: pointer; transition: background 0.3s;">
          Show Error Details
        </button>
        <div id="error-details-section" style="display: none; margin-top: 20px;">
          <span style="color: #ff6b6b;">Error Details:</span>
          <pre id="error-details" style="color: #fff; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 6px; word-break: break-all; font-size: 0.95em;">Loading...</pre>
          <div style="font-size:0.8em; color:rgba(255,255,255,0.7); margin-top:8px;">Share these details with support for faster assistance.</div>
        </div>
      </div>
    </div>

    <!-- DNS Selection Section (shown when step=dns-selection) -->
    <div id="dns-selection-section" style="display: none;">
      <div class="loading-container">
        <h2 class="loading-title">Setup Your CTERA Portal</h2>
        <p class="loading-message">
          Please provide your email address and choose a unique name for your CTERA Portal.<br>
          We'll send your portal credentials to your email once setup is complete.
        </p>
        
        <div class="customer-info" id="dns-customer-info" style="display: none;">
          <div class="customer-info-title">Subscription Details</div>
          <div class="customer-detail">
            <span class="customer-label">Customer ID:</span>
            <span class="customer-value" id="dns-customer-id">Loading...</span>
          </div>
          <div class="customer-detail">
            <span class="customer-label">Product Code:</span>
            <span class="customer-value" id="dns-product-code">Loading...</span>
          </div>
        </div>

        <div style="max-width: 500px; margin: 30px auto;">
          <form id="dns-form">
            <div style="margin-bottom: 20px;">
              <label for="customer-email" style="display: block; color: #00B4E5; font-weight: 600; margin-bottom: 8px;">
                Email Address:
              </label>
              <input 
                type="email" 
                id="customer-email" 
                name="customer-email" 
                required 
                placeholder="your-email@company.com"
                style="width: 100%; padding: 12px; border: 1px solid rgba(255,255,255,0.3); border-radius: 4px; background: rgba(255,255,255,0.1); color: white; font-size: 16px; box-sizing: border-box;"
              >
              <div style="font-size: 12px; color: rgba(255,255,255,0.6); margin-top: 5px;">
                Portal credentials will be sent to this email address
              </div>
            </div>
            
            <div style="margin-bottom: 20px;">
              <label for="dns-name" style="display: block; color: #00B4E5; font-weight: 600; margin-bottom: 8px;">
                Choose Portal Name:
              </label>
              <div style="display: flex; align-items: center; gap: 8px;">
                <input 
                  type="text" 
                  id="dns-name" 
                  name="dns-name" 
                  required 
                  placeholder="e.g. mycompany" 
                  pattern="[a-z0-9-]{3,50}"
                  title="3-50 characters, lowercase letters, numbers, and hyphens only"
                  style="flex: 1; padding: 12px; border: 1px solid rgba(255,255,255,0.3); border-radius: 4px; background: rgba(255,255,255,0.1); color: white; font-size: 16px;"
                >
                <span style="color: rgba(255,255,255,0.7);">.use.azure.cterafs.com</span>
              </div>
              <div style="font-size: 12px; color: rgba(255,255,255,0.6); margin-top: 5px;">
                Your portal will be available at: <span id="preview-url" style="color: #00CDAF;">yourname.use.azure.cterafs.com</span>
              </div>
            </div>
            
            <button 
              type="submit" 
              id="provision-btn"
              style="width: 100%; background-color: #F39200; color: white; border: none; padding: 15px; border-radius: 4px; font-family: 'Montserrat', Arial, sans-serif; font-weight: 600; font-size: 16px; cursor: pointer; transition: all 0.3s ease;"
            >
              Create My Portal
            </button>
          </form>
          
          <div id="dns-form-message" style="margin-top: 15px; text-align: center; font-size: 14px;"></div>
        </div>

        <button id="dns-show-token-btn" type="button" style="margin-top: 30px; background: #00B4E5; color: #fff; border: none; padding: 8px 18px; border-radius: 4px; font-family: 'Montserrat', Arial, sans-serif; font-weight: 500; cursor: pointer; transition: background 0.3s;">
          Show Token for Support
        </button>
        <div id="dns-token-support-section" style="display: none; margin-top: 20px;">
          <span style="color: #00B4E5;">Your AWS Marketplace Token:</span>
          <pre id="dns-aws-token" style="color: #fff; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 6px; word-break: break-all; font-size: 0.95em;">Loading...</pre>
          <div style="font-size:0.8em; color:rgba(255,255,255,0.7); margin-top:8px;">Share this token with support only if requested.</div>
        </div>
      </div>
    </div>

    <!-- Completion Section (shown after provisioning) -->
    <div id="completion-section" style="display: none;">
      <div class="loading-container">
        <h2 class="loading-title">Welcome to CTERA File Services Platform!</h2>
        <p class="loading-message">
          Thank you for subscribing via AWS Marketplace.<br>
          Your CTERA Portal has been automatically provisioned.
        </p>
        
        <div class="success-message">
          <div class="success-title">✓ Provisioning Complete</div>
          <div class="success-details">
            Your CTERA Portal tenant has been created and configured with your chosen DNS name.<br>
            <strong>You will receive an email shortly</strong> with your portal URL and login credentials at the email address you provided.
          </div>
        </div>

        <div class="customer-info" id="customer-info" style="display: none;">
          <div class="customer-info-title">Subscription Details</div>
          <div class="customer-detail">
            <span class="customer-label">Customer ID:</span>
            <span class="customer-value" id="customer-id">Loading...</span>
          </div>
          <div class="customer-detail">
            <span class="customer-label">Product Code:</span>
            <span class="customer-value" id="product-code">Loading...</span>
          </div>
          <div class="customer-detail">
            <span class="customer-label">Portal URL:</span>
            <span class="customer-value" id="tenant-name">Loading...</span>
          </div>
          <div style="font-size: 12px; color: rgba(255,255,255,0.6); margin-top: 8px; font-style: italic;">
            * Portal URL is based on the DNS name you selected
          </div>
        </div>

        <div class="next-steps">
          <div class="next-steps-title">Next Steps</div>
          <div class="next-steps-content">
            <ol>
              <li><strong>Check your email</strong> for portal access credentials</li>
              <li><strong>Log in to your portal</strong> using the provided URL and credentials</li>
              <li><strong>Change your password</strong> when prompted during first login</li>
              <li><strong>Configure your portal</strong> according to your organization's needs</li>
            </ol>
            <p>If you don't receive the email within 10 minutes, please check your spam folder or contact support.</p>
          </div>
        </div>

        <button id="show-token-btn" type="button">Show Token for Support</button>
        <div id="token-support-section">
          <span style="color: #00B4E5;">Your AWS Marketplace Token:</span>
          <pre id="aws-token">Loading...</pre>
          <div style="font-size:0.8em; color:rgba(255,255,255,0.7); margin-top:8px;">Share this token with support only if requested.</div>
        </div>
      </div>
    </div>
  </div>

  <div class="footer-container">
    <div class="footer-content">
      <div class="footer-left">
        © 2025 CTERA Networks Ltd. All Rights Reserved
      </div>
      <div class="footer-right">
        | Contact our Support Team at  <a href='mailto:support@ctera.com'>CTERA Support</a> | <a href='https://www.ctera.com/eula/'>EULA</a> 
      </div>
    </div>
  </div>

  <!-- JavaScript modules loaded in dependency order -->
  <script src="js/main.js"></script>
  <script src="js/ui.js"></script>
  <script src="js/email.js"></script>
  <script src="js/lambda.js"></script>
</body>

</html>
